{"version":3,"sources":["webpack:///./src/views/cluster-list/index.vue?0ecd","webpack:///./src/views/cluster-list/index.vue?4215","webpack:///./src/api/cluster.js","webpack:///./src/views/cluster-list/index.vue","webpack:///./src/views/cluster-list/index.vue?154b"],"names":["cluster","list","data","http","post","gettagKeyList","get","getReleases","getReleaseApps","getClassificationList","getNetworkList","getSubnetList","getPrimarySecurityGroupList","getSubSecurityGroupList","getKeypairList","getOsDiskTypeList","getVmskuList","createCluster","checkConnect","checkClusterName","getTagValueList","deleteCluster","pageLoading","ref","router","useRouter","stateOptions","filters","type","key","props","selOptionType","options","lazy","lazyLoad","node","resolve","level","console","log","clusterApi","then","res","result","arr","label","value","leaf","i","length","item","push","dictValue","dictName","ElMessage","error","errorMsg","tagKey","tagVal","message","getList","createEvent","stateToStr","state","option","find","TabelContainer","searchEvent","params","clusterId","clusterName","pageIndex","pageSize","clusterTag","tagValue","filterEvent","resetEvent","taskListVisible","taskListTimer","taskList","getTaskList","showLoading","taskCenterApi","allFinished","endTime","clearTimeout","setTimeout","finally","taskListClosed","dialogVisible","taskDetailTimer","detailData","showTaskDetail","getjobdetail","planId","activityInfos","taskDetailClosed","deleteDialogVisible","deleteItem","deleteEvent","check","deleteProtected","relieveDeleteProtected","success","getMasterIps","masterIps","split","toAmbari","warning","url","ambariIp","window","open","__exports__"],"mappings":"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","file":"js/chunk-acc27abc.94e946c5.js","sourcesContent":["export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--12-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--12-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--12-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--12-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=0&id=760ca988&lang=stylus&scoped=true\"","export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--12-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--12-oneOf-1-1!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../node_modules/postcss-loader/src/index.js??ref--12-oneOf-1-2!../../../node_modules/stylus-loader/index.js??ref--12-oneOf-1-3!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/index.js??ref--1-1!./index.vue?vue&type=style&index=1&id=760ca988&lang=stylus\"","import http from '@/utils/http'\n\nconst cluster = {\n  list(data) {\n    return http.post('/admin/api/queryclusterlist', data)\n  },\n  gettagKeyList(data) {\n    return http.get('/admin/api/gettagkeylist', data)\n  },\n  // 可用版本\n  getReleases(data) {\n    return http.get('/admin/api/getreleases', data)\n  },\n  // 获取发行版本可用的应用组件\n  getReleaseApps(data) {\n    return http.post('/admin/api/getreleaseapps', data)\n  },\n  // 获取组件配置分类列表\n  getClassificationList(data) {\n    return http.get('/admin/api/getclassificationlist', data)\n  },\n  // 获取可用网络列表\n  getNetworkList(data) {\n    return http.get('/admin/api/getnetworklist', data)\n  },\n  // 获取可用子网络列表\n  getSubnetList(data) {\n    return http.get('/admin/api/getsubnetlist', data)\n  },\n  // 获取主安全组列表\n  getPrimarySecurityGroupList(data) {\n    return http.get('/admin/api/getprimarysecuritygrouplist', data)\n  },\n  // 获取子安全组列表\n  getSubSecurityGroupList(data) {\n    return http.get('/admin/api/getsubsecuritygrouplist', data)\n  },\n  // 获取登录方式密钥对列表\n  getKeypairList(data) {\n    return http.get('/admin/api/getkeypairlist', data)\n  },\n  // 获取登录方式密钥对列表\n  getOsDiskTypeList(data) {\n    return http.get('/admin/api/getosdisktypelist', data)\n  },\n  // 获取vmsku列表\n  getVmskuList(data) {\n    return http.get('/admin/api/getvmskulist', data)\n  },\n  // 创建集群\n  createCluster(data) {\n    return http.post('/admin/api/createcluster', data)\n  },\n  // 检查数据库是否可用\n  checkConnect(data) {\n    return http.post('/admin/api/checkconnect', data)\n  },\n  // 检查集群名称是否可用\n  checkClusterName(data) {\n    return http.post('/admin/api/checkclustername', data)\n  },\n  // 根据标签Key获取Value\n  getTagValueList(data) {\n    return http.post('/admin/api/gettagvaluelist', data)\n  },\n  // 销毁集群\n  deleteCluster(data) {\n    return http.post('/admin/api/deletecluster', data)\n  },\n}\n\nexport default cluster;","/**Created by liaoyingchao on 12/1/22.*/\n\n<template>\n  <div class=\"cluster-list page-css list-css\" v-loading=\"pageLoading\">\n    <Filters :filters=\"filters\" @onSearch=\"searchEvent\" @onReset=\"resetEvent\"></Filters>\n    <div class=\"functions-row\">\n      <el-button type=\"primary\" @click=\"createEvent\">创建集群</el-button>\n    </div>\n    <div class=\"full-container\">\n      <ListContainer ref=\"TabelContainer\" :listApiFunction=\"getList\">\n        <template #default=\"tableData\">\n          <el-table\n                  :height=\"tableData.data.tableHeight\"\n                  :data=\"tableData.data.tableData\"\n                  stripe\n                  header-row-class-name=\"theader\"\n                  style=\"width: 100%\">\n            <el-table-column\n                    prop=\"clusterName\"\n                    label=\"名称 / ID\"\n                    min-width=\"120\">\n              <template #default=\"scope\">\n                <div class=\"cluster-info\" @click=\"toAmbari(scope.row)\">\n                  <div class=\"cluster-name\">\n                    {{ scope.row.clusterName }}\n                  </div>\n                  <div class=\"cluster-id\">\n                    {{ scope.row.clusterId }}\n                  </div>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column\n                    prop=\"state\"\n                    label=\"状态\"\n                    width=\"100\">\n              <template #default=\"scope\">\n                <el-button type=\"primary\" text @click=\"getTaskList(scope.row)\">\n                  <span>{{ stateToStr(scope.row.state) }}</span>\n                  <el-icon style=\"margin-left: 6px;\" class=\"is-loading\" size=\"18\" v-if=\"scope.row.state == 1 || scope.row.state == -1\">\n                    <Loading />\n                  </el-icon>\n                </el-button>\n              </template>\n            </el-table-column>\n            <!--<el-table-column-->\n            <!--prop=\"clusterMonitor\"-->\n            <!--label=\"监控\"-->\n            <!--width=\"60\">-->\n            <!--<template #default=\"scope\">-->\n            <!--<div class=\"cluster-monitor\">-->\n            <!--<div class=\"cluster-line\" :style=\"{height: 24 * num + '%'}\" v-for=\"num in [1,2,3,4]\"></div>-->\n            <!--</div>-->\n            <!--</template>-->\n            <!--</el-table-column>-->\n            <el-table-column\n                    prop=\"clusterTag\"\n                    label=\"集群标签\"\n                    min-width=\"120\">\n              <template #default=\"scope\">\n                <el-popover trigger=\"hover\" placement=\"left\" :width=\"300\" popper-class=\"popper-tag\">\n                  <template #reference>\n                    <div class=\"cluster-tags\">\n                      <template v-for=\"(item, idx) in scope.row.clusterTag\">\n                        <div v-if=\"idx < 2\" class=\"cluster-tag-item single-row\">\n                          {{ item.tagGroup }}：{{ item.tagVal }}\n                        </div>\n                      </template>\n                    </div>\n                  </template>\n                  <div class=\"popper-tag\">\n                    <div class=\"cluster-tags\">\n                      <template v-for=\"(item, idx) in scope.row.clusterTag\">\n                        <div class=\"cluster-tag-item\">\n                          {{ item.tagGroup }}：{{ item.tagVal }}\n                        </div>\n                      </template>\n                    </div>\n                  </div>\n                </el-popover>\n              </template>\n            </el-table-column>\n            <el-table-column\n                    prop=\"masterIps\"\n                    label=\"Ambari / Master IP\"\n                    min-width=\"100\">\n              <template #default=\"scope\">\n                <div>\n                  <el-button type=\"primary\" text  @click=\"toAmbari(scope.row)\">\n                    <span>{{ scope.row.ambariIp }}</span>\n                  </el-button>\n                </div>\n                <div class=\"master-ips\">\n                  <template v-for=\"(ip, idx) in getMasterIps(scope.row.masterIps)\">\n                    <div class=\"master-ip-item single-row\" v-if=\"scope.row.ambariIp != ip\">\n                      {{ ip }}\n                    </div>\n                  </template>\n                </div>\n              </template>\n            </el-table-column>\n            <el-table-column\n                    prop=\"masterNodeNum\"\n                    label=\"Ambari / Master 节点数\"\n                    width=\"130\">\n              <template #default=\"scope\">\n                {{ parseInt(scope.row.masterNodeNum || 0) + parseInt(scope.row.ambariNodeNum || 1) }}\n              </template>\n            </el-table-column>\n            <el-table-column\n                    prop=\"coreNodeNum\"\n                    label=\"Core 节点数\"\n                    width=\"70\">\n            </el-table-column>\n            <el-table-column\n                    prop=\"taskNodeNum\"\n                    label=\"Task 节点数\"\n                    width=\"70\">\n            </el-table-column>\n            <el-table-column\n                    prop=\"serviceNum\"\n                    label=\"服务数\"\n                    width=\"70\">\n            </el-table-column>\n            <el-table-column\n                    prop=\"createdTime\"\n                    label=\"创建时间\"\n                    width=\"110\">\n            </el-table-column>\n            <el-table-column\n                    fixed=\"right\"\n                    label=\"管理\"\n                    width=\"180\">\n              <template #default=\"scope\">\n                <div>\n                  <el-button type=\"primary\" text>资源</el-button>\n                  <el-button type=\"primary\" text @click=\"deleteEvent(scope.row)\" v-if=\"scope.row.state != '-2' && scope.row.state != '-1'\">销毁</el-button>\n                  <el-button type=\"primary\" text>复制</el-button>\n                  <el-button type=\"primary\" text>导出</el-button>\n                </div>\n              </template>\n            </el-table-column>\n          </el-table>\n        </template>\n      </ListContainer>\n    </div>\n    <el-dialog\n            class=\"center-dialog\"\n            v-model=\"dialogVisible\"\n            title=\"任务详情\"\n            width=\"900\"\n            destroy-on-close\n            @closed=\"taskDetailClosed\"\n    >\n      <div>\n        <TaskDetail :detailData=\"detailData\"></TaskDetail>\n      </div>\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <el-button @click=\"dialogVisible = false\">关闭</el-button>\n        </div>\n      </template>\n    </el-dialog>\n    <el-dialog\n            class=\"center-dialog\"\n            v-model=\"deleteDialogVisible\"\n            title=\"销毁集群\"\n            width=\"600\"\n            destroy-on-close\n    >\n      <div>\n        <div style=\"display: flex;align-items: center;\">\n          <el-icon size=\"30\" color=\"#e6a23c\"><Warning /></el-icon>\n          <div style=\"margin-left: 10px;\">点击确定后将删除集群及该集群下的所有资源，且不可逆，确定要销毁以下集群吗？</div>\n        </div>\n        <div v-if=\"deleteItem.deleteProtected == '1'\" style=\"margin-left: 35px;padding-top: 20px;\">\n          <el-checkbox v-model=\"deleteItem.check\">解除关闭保护</el-checkbox>\n        </div>\n      </div>\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <el-button @click=\"deleteDialogVisible = false\">关闭</el-button>\n          <el-button type=\"danger\" @click=\"deleteCluster\">确定</el-button>\n        </div>\n      </template>\n    </el-dialog>\n    <el-dialog\n            class=\"task-list-dialog center-dialog\"\n            v-model=\"taskListVisible\"\n            title=\"任务列表\"\n            width=\"900\"\n            destroy-on-close\n            @closed=\"taskListClosed\"\n    >\n      <div>\n        <el-table\n                :data=\"taskList\"\n                stripe\n                header-row-class-name=\"theader\"\n                style=\"max-height: 60vh\">\n          <el-table-column\n                  prop=\"jobName\"\n                  label=\"任务名称/ID\"\n                  min-width=\"120\">\n            <template #default=\"scope\">\n              <div class=\"task-info\">\n                <div class=\"task-name\">{{ scope.row.jobName }}</div>\n                <div class=\"task-id\">{{ scope.row.planId }}</div>\n              </div>\n            </template>\n          </el-table-column>\n          <el-table-column\n                  prop=\"clusterName\"\n                  label=\"集群名称/ID\"\n                  min-width=\"120\">\n            <template #default=\"scope\">\n              <div class=\"cluster-info\">\n                <div class=\"cluster-name\">{{ scope.row.clusterName }}</div>\n                <div class=\"cluster-id\">{{ scope.row.clusterId }}</div>\n              </div>\n            </template>\n          </el-table-column>\n          <el-table-column\n                  prop=\"state\"\n                  label=\"状态\"\n                  width=\"100\">\n          </el-table-column>\n          <el-table-column\n                  prop=\"begTime\"\n                  label=\"开始时间\"\n                  width=\"110\">\n          </el-table-column>\n          <el-table-column\n                  prop=\"endTime\"\n                  label=\"结束时间\"\n                  width=\"110\">\n          </el-table-column>\n          <el-table-column\n                  fixed=\"right\"\n                  label=\"管理\"\n                  width=\"100\">\n            <template #default=\"scope\">\n              <div>\n                <el-button type=\"primary\" text @click=\"showTaskDetail(scope.row)\">任务详情</el-button>\n              </div>\n            </template>\n          </el-table-column>\n        </el-table>\n      </div>\n      <template #footer>\n        <div class=\"dialog-footer\">\n          <el-button @click=\"taskListVisible = false\">关闭</el-button>\n        </div>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script setup>\n  import Filters from '@/components/list-comps/filters'\n  import ListContainer from '@/components/list-comps/container'\n  import {h,ref} from 'vue'\n  import {useRouter} from 'vue-router'\n  import clusterApi from '@/api/cluster'\n  import {ElMessage, ElMessageBox} from 'element-plus';\n  import { Warning, Loading } from '@element-plus/icons-vue'\n  import TaskDetail from \"../task-center/detail\"\n  import taskCenterApi from \"../../api/task-center\";\n\n  const pageLoading = ref(false)\n\n  const router = useRouter();\n\n  const stateOptions = [\n    {\"label\": \"全部\", \"value\": \"\"},\n    {\"label\": \"待创建\", \"value\": 0},\n    {\"label\": \"创建中\", \"value\": 1},\n    {\"label\": \"已创建\", \"value\": 2},\n    {\"label\": \"销毁中\", \"value\": -1},\n    {\"label\": \"已销毁\", \"value\": -2},\n  ]\n\n  const filters = ref([\n    {\n      type: 'combo-box',\n      key: 'clusterName',\n      props: {},\n      selOptionType: '',\n      options: [\n        {\n          \"type\": \"el-input\",\n          \"label\": \"集群名称\",\n          \"rules\": [],\n          \"key\": \"clusterName\",\n          \"props\": {\"placeholder\": \"请输入集群名称\", \"clearable\": true}\n        },\n        {\n          \"type\": \"el-input\",\n          \"label\": \"集群ID\",\n          \"rules\": [],\n          \"key\": \"clusterId\",\n          \"props\": {\"placeholder\": \"请输入集群ID\", \"clearable\": true}\n        }\n      ]\n    },\n    {\n      \"type\": \"RemoteSelect\",\n      \"label\": \"状态\",\n      \"rules\": [],\n      \"key\": \"state\",\n      \"props\": {\n        \"placeholder\": \"请选择状态\",\n        \"clearable\": true,\n        \"options\": stateOptions\n      }\n    },\n    {\n      \"type\": \"el-cascader\",\n      \"label\": \"集群标签\",\n      \"rules\": [],\n      \"key\": \"label\",\n      \"props\": {\n        \"placeholder\": \"请选择集群标签\",\n        \"clearable\": true,\n        props: {\n          lazy: true,\n          lazyLoad(node, resolve) {\n            const {level} = node\n            console.log(node)\n\n            if (level == 0) {\n              clusterApi.gettagKeyList().then(res => {\n                if (res.result == true) {\n                  let arr = res.data || []\n                  let options = [{label: '全部', value: '', leaf: true}]\n                  for (let i = 0; i < arr.length; i++) {\n                    let item = arr[i]\n                    options.push({\n                      value: item.dictValue,\n                      label: item.dictName,\n                      leaf: false\n                    })\n                  }\n                  resolve(options)\n                } else {\n                  ElMessage.error(res.errorMsg)\n                  resolve([])\n                }\n              })\n            } else {\n              clusterApi.getTagValueList({tagKey: node.value}).then(res => {\n                if (res.result == 1) {\n                  let arr = res.data\n                  let options = []\n                  for (let i = 0; i < arr.length; i++) {\n                    let item = arr[i]\n                    options.push({\n                      value: item.tagVal,\n                      label: item.tagVal,\n                      leaf: true\n                    })\n                  }\n                  resolve(options)\n                } else {\n                  ElMessage.error(res.message)\n                  resolve([])\n                }\n              })\n            }\n          },\n        }\n      }\n    }\n  ])\n\n  function getList(data) {\n    return clusterApi.list(data)\n  }\n\n  function createEvent() {\n    // window.open('/clustercreate')\n    router.push('/clustercreate')\n  }\n\n  function stateToStr(state) {\n    let option = stateOptions.find(item => {\n      return item.value === state\n    }) || {}\n    return option.label || ''\n  }\n\n  const TabelContainer = ref(null)\n\n  function searchEvent(data) {\n    let arr = data.label || []\n    let params = {\n      clusterId: data.clusterId,\n      clusterName: data.clusterName,\n      state: data.state,\n      pageIndex: data.pageIndex,\n      pageSize: data.pageSize\n    }\n    if (arr.length == 2) {\n      params.clusterTag = arr[0]\n      params.tagValue = arr[1]\n    }\n    TabelContainer.value.filterEvent(params);\n  }\n\n  function resetEvent(data) {\n    searchEvent(data)\n  }\n\n  let taskListVisible = ref(false)\n\n  let taskListTimer = null\n\n  const taskList = ref([])\n\n  function getTaskList(item, showLoading = true) {\n    if (showLoading) {\n      pageLoading.value = true\n    }\n    taskCenterApi.list({\n      pageIndex: 1,\n      pageSize: 50,\n      clusterId: item.clusterId\n    }).then(res => {\n      if (res.result == true) {\n        taskList.value = res.data\n        if (showLoading) {\n          taskListVisible.value = true\n        }\n\n        if (taskListVisible.value) { // 只有打开状态才轮询，防止关闭的时候正在发生请求\n          let allFinished = true\n          for (let i = 0; i < taskList.value.length; i++) {\n            if (taskList.value[i].endTime == '-') {\n              allFinished = false\n              break ;\n            }\n          }\n          if (!allFinished) {\n            if (taskListTimer) {\n              clearTimeout(taskListTimer)\n            }\n            taskListTimer = setTimeout(() => {\n              getTaskList(item, false)\n            }, 10 * 1000)\n          }\n        }\n      } else {\n        ElMessage.error(res.errorMsg)\n      }\n    }).finally(() => {\n      pageLoading.value = false\n    })\n  }\n\n  function taskListClosed() {\n    console.log(\"taskListClosed\")\n    if (taskListTimer) {\n      clearTimeout(taskListTimer)\n      taskListTimer = null\n    }\n  }\n\n  let dialogVisible = ref(false)\n\n  let taskDetailTimer = null\n\n  const detailData = ref({})\n\n  function showTaskDetail(item, showLoading = true) {\n    if (showLoading) {\n      pageLoading.value = true\n    }\n    taskCenterApi.getjobdetail({planId: item.planId}).then(res => {\n      if (res.result == true) {\n        detailData.value = res.data\n        if (showLoading) {\n          dialogVisible.value = true\n        }\n\n        if (dialogVisible.value) { // 只有打开状态才轮询，防止关闭的时候正在发生请求\n          let activityInfos = detailData.value.activityInfos || []\n          let allFinished = true\n          for (let i = 0; i < activityInfos.length; i++) {\n            if (activityInfos[i].endTime == '-') {\n              allFinished = false\n              break ;\n            }\n          }\n          if (!allFinished) {\n            if (taskDetailTimer) {\n              clearTimeout(taskDetailTimer)\n            }\n            taskDetailTimer = setTimeout(() => {\n              showTaskDetail(item, false)\n            }, 10 * 1000)\n          }\n        }\n      } else {\n        ElMessage.error(res.errorMsg)\n      }\n    }).finally(() => {\n      pageLoading.value = false\n    })\n  }\n\n  function taskDetailClosed() {\n    console.log(\"taskListClosed\")\n    if (taskDetailTimer) {\n      clearTimeout(taskDetailTimer)\n      taskDetailTimer = null\n    }\n  }\n\n  let deleteDialogVisible = ref(false)\n  const deleteItem = ref({})\n\n  function deleteEvent(item) {\n    deleteItem.value = item\n    deleteItem.value.check = false\n    deleteDialogVisible.value = true\n  }\n\n  function deleteCluster() {\n    if (deleteItem.value.deleteProtected == '1' && deleteItem.value.check == false) {\n      ElMessage.error(\"集群关闭保护中，请先勾选\\\"解除关闭保护\\\"再销毁\")\n      return ;\n    }\n    pageLoading.value = true\n    clusterApi.deleteCluster({\n      clusterId: deleteItem.value.clusterId,\n      relieveDeleteProtected: deleteItem.value.check\n    }).then(res => {\n      if (res.result == true) {\n        deleteDialogVisible.value = false\n        ElMessage.success(\"集群开始销毁中...\")\n        searchEvent()\n      } else {\n        ElMessage.error(res.errorMsg)\n      }\n    }).finally(() => {\n      pageLoading.value = false\n    })\n  }\n\n  function getMasterIps(masterIps) {\n    return masterIps.split(',')\n  }\n\n  function toAmbari(item) {\n    if (item.state != '2') {\n      ElMessage.warning('集群已销毁或还未创建成功！')\n      return ;\n    }\n    let url = 'http://' + item.ambariIp + ':8080'\n    window.open(url)\n  }\n\n</script>\n\n<style lang=\"stylus\" scoped type=\"text/stylus\">\n  .cluster-list {\n    .full-container {\n      .cluster-info {\n        cursor pointer;\n\n        .cluster-name {\n          font-size 14px;\n          color #315fce;\n        }\n\n        .cluster-id {\n          font-size 12px;\n          color #315fce;\n        }\n      }\n\n      .cluster-monitor {\n        height 24px;\n        display flex;\n        align-items flex-end;\n        cursor pointer;\n\n        .cluster-line {\n          margin 0 1px;\n          background-color #999;\n          width 4px;\n        }\n      }\n\n      .cluster-tags {\n        display flex;\n        flex-wrap wrap;\n\n        .cluster-tag-item {\n          padding 0px 5px;\n          background-color #b5eeff;\n          border-radius 3px;\n          margin 3px 8px 3px 0;\n          cursor default;\n          color #666;\n        }\n      }\n      .master-ips {\n        display flex;\n        flex-wrap wrap;\n        .master-ip-item {\n          margin 3px 10px 3px 0;\n          color #666;\n        }\n      }\n    }\n\n    >>>.task-list-dialog {\n      // 表头\n      .theader {\n        td, th {\n          background-color: #F8F8F8 !important;\n          .cell {\n            word-break break-word;\n          }\n        }\n      }\n\n      .cluster-info, .task-info {\n        .cluster-name, .task-name {\n          font-size 14px;\n        }\n\n        .cluster-id, .task-id {\n          font-size 12px;\n        }\n      }\n\n      .el-table__cell {\n        .el-button {\n          padding-left 0;\n          padding-right 0;\n        }\n      }\n    }\n  }\n</style>\n\n<style lang=\"stylus\" type=\"text/stylus\">\n  .popper-tag {\n\n    .cluster-tags {\n      display flex;\n      flex-wrap wrap;\n\n      .cluster-tag-item {\n        padding 0px 5px;\n        background-color #b5eeff;\n        border-radius 3px;\n        margin 3px 8px 3px 0;\n        cursor default;\n        color #666;\n      }\n    }\n  }\n</style>","import script from \"./index.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./index.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=760ca988&lang=stylus&scoped=true\"\nimport \"./index.vue?vue&type=style&index=1&id=760ca988&lang=stylus\"\n\nimport exportComponent from \"/Users/liaoyingchao/sourcetree/sdp-magement-web/node_modules/@vue/cli-service/node_modules/vue-loader-v16/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-760ca988\"]])\n\nexport default __exports__"],"sourceRoot":""}